<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-7">
      <!-- CARD PRINCIPAL -->
      <mat-card class="p-4 card-cadastro">
        <!-- TÍTULO ÚNICO -->
        <h2 class="text-center mb-3">
          <ng-container *ngIf="tipoCadastro === 'farmacia'; else tituloUsuario">
            Cadastro de Farmácia
          </ng-container>

          <ng-template #tituloUsuario>
            {{ isEditing ? "Editar Usuário" : "Cadastro de Usuário" }}
          </ng-template>
        </h2>

        <!-- FORMULÁRIO -->
        <form [formGroup]="usuarioForm" (ngSubmit)="onSubmit()">
          <!-- GRUPO CONTA -->
          <div formGroupName="conta">
            <!-- EMAIL -->
            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" />

              <mat-error
                *ngIf="usuarioForm.get('conta.email')?.hasError('required')"
              >
                O email é obrigatório.
              </mat-error>

              <mat-error
                *ngIf="usuarioForm.get('conta.email')?.hasError('email')"
              >
                Digite um email válido.
              </mat-error>
            </mat-form-field>

            <!-- SENHA -->
            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Senha</mat-label>
              <input matInput type="password" formControlName="senha" />

              <mat-error
                *ngIf="usuarioForm.get('conta.senha')?.hasError('required')"
              >
                A senha é obrigatória.
              </mat-error>
            </mat-form-field>
          </div>

          <!-- GRUPO PERFIL -->
          <div formGroupName="perfil">
            <!-- Nome -->
            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Nome</mat-label>
              <input matInput type="text" formControlName="nome" />

              <mat-error
                *ngIf="usuarioForm.get('perfil.nome')?.hasError('required')"
              >
                O nome é obrigatório.
              </mat-error>
            </mat-form-field>

            <!-- Sexo — Apenas usuário comum -->
            <ng-container *ngIf="tipoCadastro !== 'farmacia'">
              <mat-form-field appearance="outline" class="w-100 mb-3">
                <mat-label>Sexo</mat-label>

                <mat-select formControlName="sexo">
                  <mat-option value="M">Masculino</mat-option>
                  <mat-option value="F">Feminino</mat-option>
                </mat-select>

                <mat-error
                  *ngIf="usuarioForm.get('perfil.sexo')?.hasError('required')"
                >
                  O sexo é obrigatório.
                </mat-error>
              </mat-form-field>
            </ng-container>

            <!-- Altura — Apenas usuário comum -->
            <ng-container *ngIf="tipoCadastro !== 'farmacia'">
              <mat-form-field appearance="outline" class="w-100 mb-3">
                <mat-label>Altura (ex: 1.75)</mat-label>
                <input
                  matInput
                  type="number"
                  step="0.01"
                  formControlName="altura"
                />

                <mat-error
                  *ngIf="usuarioForm.get('perfil.altura')?.hasError('required')"
                >
                  A altura é obrigatória.
                </mat-error>
              </mat-form-field>
            </ng-container>
          </div>

          <!-- CAMPOS EXCLUSIVOS PARA FARMÁCIA -->
          <ng-container *ngIf="tipoCadastro === 'farmacia'">
            <!-- CNPJ -->
            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>CNPJ</mat-label>
              <input matInput type="text" formControlName="cnpj" />

              <mat-error *ngIf="usuarioForm.get('cnpj')?.hasError('required')">
                CNPJ é obrigatório.
              </mat-error>
            </mat-form-field>

            <!-- Telefone -->
            <mat-form-field appearance="outline" class="w-100 mb-3">
              <mat-label>Telefone</mat-label>
              <input matInput type="text" formControlName="telefone" />

              <mat-error
                *ngIf="usuarioForm.get('telefone')?.hasError('required')"
              >
                Telefone é obrigatório.
              </mat-error>
            </mat-form-field>
          </ng-container>

          <!-- Botão -->
          <button
            mat-raised-button
            color="primary"
            class="w-100 mt-3"
            type="submit"
            [disabled]="usuarioForm.invalid"
          >
            {{ isEditing ? "Atualizar" : "Cadastrar" }}
          </button>
        </form>
      </mat-card>
    </div>
  </div>
</div>
